import{W as z,r as d,j as e,a as O,Y as G}from"./app-4CarAZae.js";import{A as H,a as J}from"./AuthenticatedLayout-DlZAqirn.js";import Q from"./Content-CakR-rKP.js";import{T as U}from"./TextAreaInput-D3aa6kLy.js";import{I as X}from"./InputLabel-D2XIgsB6.js";import{I as h}from"./InputError-BzZEBFuT.js";import{S as Z}from"./ScrollBar-2ExapV3B.js";import{S as ee}from"./SuccessMessage-CL-2JUjC.js";import{T as se}from"./Title-Dy3FFUwd.js";import"./ApplicationLogo-Dv8uwSlW.js";import"./transition-B3zTIZ2S.js";import"./NavLink-Bq0O64v2.js";import"./DarkMode-Bf1Neqjf.js";import"./iconBase-TbwvlisU.js";import"./ResponsiveMenu-BnbI3YqC.js";import"./index-_Gq6pFcl.js";import"./Modal-DeS_P8Lr.js";import"./TextInput-DyNG2S4m.js";function be({auth:l,services:w,customers:B,amountKinds:S,comissions:u,remainingBalanceProduct:C,remainingBalanceCenter:A,success:f,message:I}){const{data:t,setData:n,post:L,errors:x,reset:K}=z({customer_id:1,user_id:l.user.id,service_id:0,amount_kind_id:0,comission_admin:0,comission_super:0,net:0,amount:0,status:"in_progress",reject_reason:"",data_kind_1:"",data_kind_2:"",notes:""}),[r,V]=d.useState(),[v,P]=d.useState([]),[k,j]=d.useState(null),[N,g]=d.useState(0),[o,D]=d.useState(!1),[E,R]=d.useState(""),[_,W]=d.useState(""),[F,M]=d.useState(""),[T,$]=d.useState(""),Y=()=>{g(0),j(null),K()};d.useEffect(()=>{if(r){Y();const s=S.data.filter(a=>{const i=a.service_id===r.id,p=u.data.find(c=>c.user_id===l.user.id&&c.amount_kind_id===a.id);return i&&p});if(P(s),r.kind==="const")j(null),D(!1);else if(D(!0),r.kind==="var"&&s.length>0){const a=s[0];if(a){const i=u.data.find(y=>y.user_id===l.user.id&&y.amount_kind_id===a.id),p=i?i.comission_admin:0,c=i?i.comission_super:0,b=i?i.comission_admin+i.comission_super:0;g(b);const m=a.amount+a.amount*b/100;n(y=>({...y,comission_admin:p,comission_super:c,net:m,amount:a.amount,amount_kind_id:a.id,service_id:a.service_id}))}}R(r.data_1.name||""),W(r.data_2?r.data_2.name:"")}},[r,u,l.user.id,S]),d.useEffect(()=>{if(k&&r.kind==="const"){const s=v.find(a=>a.id===parseInt(k));if(s){const a=u.data.find(m=>m.user_id===l.user.id&&m.amount_kind_id===s.id),i=a?a.comission_admin:0,p=a?a.comission_super:0,c=a?a.comission_admin+a.comission_super:0;g(c);const b=s.amount+s.amount*c/100;n(m=>({...m,comission_admin:i,comission_super:p,net:b,amount:s.amount,amount_kind_id:s.id,service_id:s.service_id}))}}},[k,v,u,l.user.id,j]),d.useEffect(()=>{if(o&&t.amount>0&&N>=0){const s=parseInt(t.amount)+t.amount*(t.comission_admin+t.comission_super)/100;n(a=>({...a,net:s}))}},[t.amount,N,o]),d.useEffect(()=>{f&&(K(),g(0))},[f]);const q=s=>{s.preventDefault(),C>=t.amount&&A>=t.amount?(M(""),$(""),L(route("order.store"))):(C<t.amount&&M("لايوجد رصيد كافي للمنتج لاتمام العملية"),A<t.amount&&$("لايوجد رصيد كافي لدى المركز لاتمام العملية"))};return e.jsxs(H,{user:l.user,message:I,header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("nav",{className:"text-me text-gray-800 dark:text-gray-200 flex justify-between items-center",children:[e.jsx(se,{children:"الخدمات"}),e.jsx(O,{href:"/",className:"hover:underline p-2",children:" التصنيفات "}),"  >   ",r&&e.jsxs(e.Fragment,{children:[e.jsx(O,{href:`/products?id=${r.product.category.id}`,className:"hover:underline text-nowrap",children:r.product.category.name}),"    > ",e.jsx("span",{className:"text-gray-500 p-2",children:r.product.name})]})]}),e.jsx(Z,{message:I})]}),children:[e.jsx(G,{title:"الخدمات"}),e.jsx("div",{className:"py-2",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[f&&e.jsx(ee,{message:f}),(F||T)&&e.jsxs("div",{className:"bg-red-500 py-2 px-4 text-white rounded mx-2 mt-2",children:[F," - ",T]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-6 bg-gray-100 dark:bg-gray-900 dark:text-white max-w-7xl mx-auto",children:[w.data.length>0?e.jsx("div",{className:"lg:col-span-3 flex flex-col space-y-1 ",children:w.data.map(s=>e.jsx(Q,{...s,onClick:()=>V(s)},s.id))}):e.jsx("div",{className:"lg:col-span-10 p-5",children:e.jsx("p",{className:"text-center text-gray-500",children:"لا يوجد خدمات متوفرة."})}),r&&e.jsx("div",{className:"lg:col-span-7 p-2 bg-gray-200 dark:bg-gray-800 shadow-lg mb-6 ml-3 rounded-lg",children:e.jsxs("form",{onSubmit:q,className:"p-2 sm:p-2 bg-white dark:bg-gray-800 shadow sm:rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center shadow-md px-3 rounded-md bg-token1 dark:bg-token2/40 text-white h-[50px]",children:[e.jsxs("p",{className:"text-xl",children:[r.product.category.name," / ",r.product.name," / ",r.name]}),e.jsx("button",{className:"text-xl font-semibold",onClick:()=>V(null),children:"×"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:space-x-4 space-y-4 lg:space-y-0 gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{children:"اختر الزبون:"}),e.jsx("select",{className:"w-full border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:t.customer_id,onChange:s=>n("customer_id",s.target.value),children:B.data.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))}),e.jsx(h,{message:x.customer_id,className:"mt-2"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{children:"اختر تفاصيل الخدمة:"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:t.amount_kind_id,onChange:s=>j(s.target.value),disabled:o,children:[!o&&e.jsx("option",{value:"",children:"اختر تفاصيل الخدمة"}),v.map(s=>e.jsx("option",{value:s.id,children:s.kindName.name},s.id))]}),e.jsx(h,{message:x.amount_kind_id,className:"mt-2"})]})]}),e.jsxs("div",{className:"grid sm:grid-cols-1 lg:grid-cols-2 lg:space-x-4 space-y-4 lg:space-y-0 mt-5",children:[e.jsxs("div",{className:"grid sm:grid-cols-1 lg:grid-cols-3 gap-2 lg:ml-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{children:"قيمة الخدمة:"}),e.jsx("input",{type:"number",value:t.amount,onChange:s=>o&&n("amount",s.target.value),readOnly:!o,className:"w-full border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"}),e.jsx(h,{message:x.amount,className:"mt-2"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{children:"العمولة:"}),e.jsx("input",{type:"text",value:`${N} %`,onChange:s=>o&&g(parseFloat(s.target.value)),readOnly:!o,className:"w-full border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"}),e.jsx(h,{message:x.comission_admin,className:"mt-2"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{children:"الصافي:"}),e.jsx("input",{type:"text",value:t.net,readOnly:!0,className:"w-full border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"})]})]}),e.jsxs("div",{className:`grid ${_?"lg:grid-cols-2":"sm:grid-cols-1"}`,children:[E&&e.jsxs("div",{className:`mb-4 ${_&&"lg:ml-4"}`,children:[e.jsx("label",{children:E}),e.jsx("input",{type:"text",value:t.data_kind_1,onChange:s=>n("data_kind_1",s.target.value),className:"w-full border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"}),e.jsx(h,{message:x.data_kind_1,className:"mt-2"})]}),_&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{children:_}),e.jsx("input",{type:"text",value:t.data_kind_2,onChange:s=>n("data_kind_2",s.target.value),className:"w-full border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"})]})]})]}),e.jsxs("div",{className:"lg:ml-4",children:[e.jsx(X,{htmlFor:"category_notes",value:"ملاحظات"}),e.jsx(U,{id:"category_notes",name:"notes",className:"mt-1 block w-full h-10",value:t.notes,onChange:s=>n("notes",s.target.value)})]}),e.jsx("div",{className:"mt-2 text-center",children:e.jsx(J,{children:"موافق"})})]})]})})]})]})})]})}export{be as default};
